"use strict";!function(e,t){"function"==typeof define&&define.amd?define(["./ResizeSensor.js"],t):"object"==typeof exports?module.exports=t(require("./ResizeSensor.js")):(e.ElementQueries=t(e.ResizeSensor),e.ElementQueries.listen())}("undefined"!=typeof window?window:this,function(v){function t(){var s,m={},o=[];function a(e){e=e||document.documentElement;var t=window.getComputedStyle(e,null).fontSize;return parseFloat(t)||16}function c(e,t){var n=t.split(/\d/),i=n[n.length-1];switch(t=parseFloat(t),i){case"px":return t;case"em":return t*a(e);case"rem":return t*a();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var r=document.documentElement.clientWidth/100,s=document.documentElement.clientHeight/100;return t*(0,Math["vmin"===i?"min":"max"])(r,s);default:return t}}function n(e,t){var n,i,r,s,o,a,l,u;this.element=e;var d=["min-width","min-height","max-width","max-height"];this.call=function(){for(n in r=function(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}(this.element),a={},m[t])m[t].hasOwnProperty(n)&&(i=m[t][n],s=c(this.element,i.value),o="width"===i.property?r.width:r.height,u=i.mode+"-"+i.property,l="","min"===i.mode&&s<=o&&(l+=i.value),"max"===i.mode&&o<=s&&(l+=i.value),a[u]||(a[u]=""),l&&-1===(" "+a[u]+" ").indexOf(" "+l+" ")&&(a[u]+=" "+l));for(var e in d)d.hasOwnProperty(e)&&(a[d[e]]?this.element.setAttribute(d[e],a[d[e]].substr(1)):this.element.removeAttribute(d[e]))}}function l(e,t){e.elementQueriesSetupInformation||(e.elementQueriesSetupInformation=new n(e,t)),e.elementQueriesSensor||(e.elementQueriesSensor=new v(e,function(){e.elementQueriesSetupInformation.call()}))}function u(e,t,n,i){if(void 0===m[e]){m[e]=[];var r=o.length;s.innerHTML+="\n"+e+" {animation: 0.1s element-queries;}",s.innerHTML+="\n"+e+" > .resize-sensor {min-width: "+r+"px;}",o.push(e)}m[e].push({mode:t,property:n,value:i})}function d(e){var t;if(document.querySelectorAll&&(t=e?e.querySelectorAll.bind(e):document.querySelectorAll.bind(document)),t||"undefined"==typeof $$||(t=$$),t||"undefined"==typeof jQuery||(t=jQuery),!t)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return t}function i(i){var r=[],s=[],o=[],a=0,l=-1,u=[];for(var e in i.children)if(i.children.hasOwnProperty(e)&&i.children[e].tagName&&"img"===i.children[e].tagName.toLowerCase()){r.push(i.children[e]);var t=i.children[e].getAttribute("min-width")||i.children[e].getAttribute("data-min-width"),n=i.children[e].getAttribute("data-src")||i.children[e].getAttribute("url");o.push(n);var d={minWidth:t};s.push(d),t?i.children[e].style.display="none":(a=r.length-1,i.children[e].style.display="block")}function m(){var e,t=!1;for(e in r)r.hasOwnProperty(e)&&s[e].minWidth&&i.offsetWidth>s[e].minWidth&&(t=e);if(l!==(t=t||a))if(u[t])r[l].style.display="none",r[t].style.display="block",l=t;else{var n=new Image;n.onload=function(){r[t].src=o[t],r[l].style.display="none",r[t].style.display="block",u[t]=!0,l=t},n.src=o[t]}else r[t].src=o[t]}l=a,i.resizeSensorInstance=new v(i,m),m()}var h=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,f=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim;function r(e){var t,n,i,r;for(e=e.replace(/'/g,'"');null!==(t=h.exec(e));)for(n=t[1]+t[3],i=t[2];null!==(r=f.exec(i));)u(n,r[1],r[2],r[3])}function p(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||r(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?r(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||r(t):4===e[n].type?p(e[n].cssRules||e[n].rules):3===e[n].type&&e[n].styleSheet.hasOwnProperty("cssRules")&&p(e[n].styleSheet.cssRules)}var y=!1;this.init=function(){var e="animationstart";void 0!==document.documentElement.style.webkitAnimationName?e="webkitAnimationStart":void 0!==document.documentElement.style.MozAnimationName?e="mozanimationstart":void 0!==document.documentElement.style.OAnimationName&&(e="oanimationstart"),document.body.addEventListener(e,function(e){var t=e.target,n=t&&window.getComputedStyle(t,null),i=n&&n.getPropertyValue("animation-name");if(i&&-1!==i.indexOf("element-queries")){t.elementQueriesSensor=new v(t,function(){t.elementQueriesSetupInformation&&t.elementQueriesSetupInformation.call()});var r=window.getComputedStyle(t.resizeSensor,null).getPropertyValue("min-width");r=parseInt(r.replace("px","")),l(e.target,o[r])}}),y||((s=document.createElement("style")).type="text/css",s.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img {width: 100%;}",s.innerHTML+="\n@keyframes element-queries { 0% { visibility: inherit; } }",document.getElementsByTagName("head")[0].appendChild(s),y=!0);for(var t=0,n=document.styleSheets.length;t<n;t++)try{document.styleSheets[t].href&&0===document.styleSheets[t].href.indexOf("file://")&&console.warn("CssElementQueries: unable to parse local css files, "+document.styleSheets[t].href),p(document.styleSheets[t].cssRules||document.styleSheets[t].rules||document.styleSheets[t].cssText)}catch(e){}!function(){for(var e=d()("[data-responsive-image],[responsive-image]"),t=0,n=e.length;t<n;t++)i(e[t])}()},this.findElementQueriesElements=function(e){!function(e){var t=d(e);for(var n in m)if(m.hasOwnProperty(n))for(var i=t(n,e),r=0,s=i.length;r<s;r++)l(i[r],n)}(e)},this.update=function(){this.init()}}t.update=function(){t.instance.update()},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor):e.resizeSensorInstance&&(e.resizeSensorInstance.detach(),delete e.resizeSensorInstance)},t.init=function(){t.instance||(t.instance=new t),t.instance.init()};return t.findElementQueriesElements=function(e){t.instance.findElementQueriesElements(e)},t.listen=function(){!function(e){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))},10);else window.onload=e}(t.init)},t});